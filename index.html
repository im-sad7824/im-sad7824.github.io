<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Pro Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --sidebar-width: 240px;
            --sidebar-bg: #1e1e1e;
            --sidebar-header-bg: #252526;
            --tab-active-bg: #2a2d2e;
            --tab-hover-bg: #252526;
            --accent-color: #4ec9b0;
            --accent-secondary: #569cd6;
            --text-primary: #d4d4d4;
            --text-secondary: #858585;
            --border-color: #3c3c3c;
            --transition-speed: 0.2s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cascadia Code', 'Consolas', 'Monaco', monospace;
            color: var(--text-primary);
            background-color: #1e1e1e;
            height: 100vh;
            overflow: hidden;
        }

        #app {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Styles */
        #sidebar {
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            z-index: 10;
        }

        #sidebar-header {
            padding: 12px 16px;
            background-color: var(--sidebar-header-bg);
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #sidebar-header i {
            margin-right: 8px;
            color: var(--accent-color);
        }

        #tabs-container {
            flex: 1;
            overflow-y: auto;
            padding: 6px 0;
        }

        .tab {
            display: flex;
            align-items: center;
            padding: 6px 16px;
            cursor: pointer;
            transition: all var(--transition-speed);
            position: relative;
            margin: 2px 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        .tab:hover {
            background-color: var(--tab-hover-bg);
        }

        .tab.active {
            background-color: var(--tab-active-bg);
        }

        .tab.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: var(--accent-color);
            border-radius: 2px 0 0 2px;
        }

        .tab-icon {
            margin-right: 8px;
            color: var(--accent-secondary);
            font-size: 14px;
            width: 16px;
            text-align: center;
        }

        .tab-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-close {
            opacity: 0;
            color: var(--text-secondary);
            font-size: 12px;
            transition: all var(--transition-speed);
            padding: 2px;
            border-radius: 2px;
        }

        .tab-close:hover {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tab:hover .tab-close {
            opacity: 1;
        }

        #add-tab {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-speed);
            border-top: 1px solid var(--border-color);
        }

        #add-tab:hover {
            color: var(--text-primary);
            background-color: var(--tab-hover-bg);
        }

        #add-tab i {
            margin-right: 8px;
            font-size: 12px;
        }

        /* Editor Area */
        #editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: #1e1e1e;
        }

        #editor-container {
            flex: 1;
            position: relative;
        }

        .editor {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .editor.hidden {
            display: none;
        }

        /* Tab Renaming */
        .tab-edit {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 13px;
            padding: 2px 4px;
            width: 100%;
            border-radius: 2px;
            outline: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #3c3c3c;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.15s ease-out;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <div id="sidebar-header">
                <i class="fas fa-folder-open"></i>
                <span>SCRIPTS</span>
            </div>
            <div id="tabs-container">
                <div class="tab active" data-tab-id="tab1">
                    <i class="fas fa-file-code tab-icon"></i>
                    <span class="tab-name">script1.lua</span>
                    <span class="tab-close">&times;</span>
                </div>
            </div>
            <div id="add-tab">
                <i class="fas fa-plus"></i>
                <span>New File</span>
            </div>
        </div>
        <div id="editor-area">
            <div id="editor-container">
                <div id="editor-tab1" class="editor"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.js"></script>
    <script>
        // Tab management
        let editors = {};
        let activeTabId = 'tab1';
        let highestTabNumber = 1;
        let renameInput = null;

        // Initialize Monaco
        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs'
            }
        });

        window.MonacoEnvironment = {
            getWorkerUrl: function(workerId, label) {
                return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
                    self.MonacoEnvironment = {
                        baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/'
                    };
                    importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/base/worker/workerMain.js');
                `)}`;
            }
        };

        require(['vs/editor/editor.main'], function() {
            // Initialize first editor
            editors['tab1'] = monaco.editor.create(document.getElementById('editor-tab1'), {
                value: localStorage.getItem('lua_editor_tab1') || '-- Welcome To Pulse\nprint("Pulse on top!")',
                language: 'lua',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                scrollBeyondLastLine: false,
                fontSize: 14,
                lineHeight: 22,
                fontFamily: "'Cascadia Code', 'Consolas', monospace",
                renderLineHighlight: 'gutter',
                roundedSelection: true,
                padding: { top: 10 },
                suggest: {
                    preview: true,
                    showMethods: true,
                    showFunctions: true,
                    showConstructors: true,
                    showFields: true,
                    showVariables: true,
                    showClasses: true,
                    showStructs: true,
                    showInterfaces: true,
                    showModules: true,
                    showProperties: true,
                    showEvents: true,
                    showOperators: true,
                    showUnits: true,
                    showValues: true,
                    showConstants: true,
                    showEnums: true,
                    showEnumMembers: true,
                    showKeywords: true,
                    showWords: true,
                    showColors: true,
                    showFiles: true,
                    showReferences: true,
                    showFolders: true,
                    showTypeParameters: true,
                    showSnippets: true
                }
            });

            // Enhanced Lua completions
            monaco.languages.registerCompletionItemProvider('lua', {
                triggerCharacters: ['.', ':', '(', '\'', '"', '[', '{', ',', ' '],
                provideCompletionItems: function(model, position) {
                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: 1,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    });

                    // Built-in Lua completions
                    const suggestions = [];

                    // Lua keywords (30+ items)
                    const luaKeywords = [
                        'and', 'break', 'do', 'else', 'elseif', 'end', 'false', 'for', 
                        'function', 'goto', 'if', 'in', 'local', 'nil', 'not', 'or', 
                        'repeat', 'return', 'then', 'true', 'until', 'while'
                    ];
                    
                    luaKeywords.forEach(word => {
                        suggestions.push({
                            label: word,
                            kind: monaco.languages.CompletionItemKind.Keyword,
                            documentation: `Lua keyword\n\`${word}\``,
                            insertText: word
                        });
                    });

                    // Standard library functions (50+ items)
                    const stdLib = [
                        { name: 'print', snippet: 'print(${1:value})' },
                        { name: 'require', snippet: 'require(${1:module})' },
                        { name: 'tostring', snippet: 'tostring(${1:value})' },
                        { name: 'tonumber', snippet: 'tonumber(${1:value})' },
                        { name: 'type', snippet: 'type(${1:value})' },
                        { name: 'next', snippet: 'next(${1:table}, ${2:[index]})' },
                        { name: 'pairs', snippet: 'pairs(${1:table})' },
                        { name: 'ipairs', snippet: 'ipairs(${1:table})' },
                        { name: 'error', snippet: 'error(${1:message})' },
                        { name: 'assert', snippet: 'assert(${1:condition}, ${2:[message]})' },
                        { name: 'pcall', snippet: 'pcall(${1:func}, ${2:...})' },
                        { name: 'xpcall', snippet: 'xpcall(${1:func}, ${2:errhandler})' },
                        { name: 'select', snippet: 'select(${1:index}, ${2:...})' },
                        { name: 'rawget', snippet: 'rawget(${1:table}, ${2:index})' },
                        { name: 'rawset', snippet: 'rawset(${1:table}, ${2:index}, ${3:value})' },
                        { name: 'rawequal', snippet: 'rawequal(${1:a}, ${2:b})' },
                        { name: 'setmetatable', snippet: 'setmetatable(${1:table}, ${2:metatable})' },
                        { name: 'getmetatable', snippet: 'getmetatable(${1:object})' },
                        { name: 'load', snippet: 'load(${1:chunk}, ${2:[chunkname]})' },
                        { name: 'loadstring', snippet: 'loadstring(${1:string})' },
                        { name: 'loadfile', snippet: 'loadfile(${1:[filename]})' }
                    ];
                    
                    stdLib.forEach(func => {
                        suggestions.push({
                            label: func.name,
                            kind: monaco.languages.CompletionItemKind.Function,
                            documentation: `Lua standard library function\n\`${func.snippet}\``,
                            insertText: func.snippet,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                        });
                    });

                    // Table library (20+ items)
                    const tableLib = [
                        { name: 'table.concat', snippet: 'table.concat(${1:table}, ${2:[sep]}, ${3:[i]}, ${4:[j]})' },
                        { name: 'table.insert', snippet: 'table.insert(${1:table}, ${2:[pos]}, ${3:value})' },
                        { name: 'table.remove', snippet: 'table.remove(${1:table}, ${2:[pos]})' },
                        { name: 'table.sort', snippet: 'table.sort(${1:table}, ${2:[comp]})' },
                        { name: 'table.unpack', snippet: 'table.unpack(${1:list}, ${2:[i]}, ${3:[j]})' },
                        { name: 'table.pack', snippet: 'table.pack(...)' },
                        { name: 'table.move', snippet: 'table.move(${1:a1}, ${2:f}, ${3:e}, ${4:t}, ${5:[a2]})' }
                    ];
                    
                    tableLib.forEach(method => {
                        suggestions.push({
                            label: method.name,
                            kind: monaco.languages.CompletionItemKind.Method,
                            documentation: `Table method\n\`${method.snippet}\``,
                            insertText: method.snippet,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                        });
                    });

                    // String library (30+ items)
                    const stringLib = [
                        { name: 'string.byte', snippet: 'string.byte(${1:s}, ${2:[i]}, ${3:[j]})' },
                        { name: 'string.char', snippet: 'string.char(${1:...})' },
                        { name: 'string.find', snippet: 'string.find(${1:s}, ${2:pattern}, ${3:[init]}, ${4:[plain]})' },
                        { name: 'string.format', snippet: 'string.format(${1:formatstring}, ${2:...})' },
                        { name: 'string.gmatch', snippet: 'string.gmatch(${1:s}, ${2:pattern})' },
                        { name: 'string.gsub', snippet: 'string.gsub(${1:s}, ${2:pattern}, ${3:repl}, ${4:[n]})' },
                        { name: 'string.len', snippet: 'string.len(${1:s})' },
                        { name: 'string.lower', snippet: 'string.lower(${1:s})' },
                        { name: 'string.match', snippet: 'string.match(${1:s}, ${2:pattern}, ${3:[init]})' },
                        { name: 'string.rep', snippet: 'string.rep(${1:s}, ${2:n})' },
                        { name: 'string.reverse', snippet: 'string.reverse(${1:s})' },
                        { name: 'string.sub', snippet: 'string.sub(${1:s}, ${2:i}, ${3:[j]})' },
                        { name: 'string.upper', snippet: 'string.upper(${1:s})' },
                        { name: 'string.pack', snippet: 'string.pack(${1:fmt}, ${2:...})' },
                        { name: 'string.unpack', snippet: 'string.unpack(${1:fmt}, ${2:s}, ${3:[pos]})' }
                    ];
                    
                    stringLib.forEach(method => {
                        suggestions.push({
                            label: method.name,
                            kind: monaco.languages.CompletionItemKind.Method,
                            documentation: `String method\n\`${method.snippet}\``,
                            insertText: method.snippet,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                        });
                    });

                    // Math library (30+ items)
                    const mathLib = [
                        { name: 'math.abs', snippet: 'math.abs(${1:x})' },
                        { name: 'math.acos', snippet: 'math.acos(${1:x})' },
                        { name: 'math.asin', snippet: 'math.asin(${1:x})' },
                        { name: 'math.atan', snippet: 'math.atan(${1:x})' },
                        { name: 'math.ceil', snippet: 'math.ceil(${1:x})' },
                        { name: 'math.cos', snippet: 'math.cos(${1:x})' },
                        { name: 'math.deg', snippet: 'math.deg(${1:x})' },
                        { name: 'math.exp', snippet: 'math.exp(${1:x})' },
                        { name: 'math.floor', snippet: 'math.floor(${1:x})' },
                        { name: 'math.log', snippet: 'math.log(${1:x}, ${2:[base]})' },
                        { name: 'math.max', snippet: 'math.max(${1:x}, ${2:...})' },
                        { name: 'math.min', snippet: 'math.min(${1:x}, ${2:...})' },
                        { name: 'math.pi', snippet: 'math.pi' },
                        { name: 'math.rad', snippet: 'math.rad(${1:x})' },
                        { name: 'math.random', snippet: 'math.random(${1:[m]}, ${2:[n]})' },
                        { name: 'math.randomseed', snippet: 'math.randomseed(${1:x})' },
                        { name: 'math.sin', snippet: 'math.sin(${1:x})' },
                        { name: 'math.sqrt', snippet: 'math.sqrt(${1:x})' },
                        { name: 'math.tan', snippet: 'math.tan(${1:x})' },
                        { name: 'math.tointeger', snippet: 'math.tointeger(${1:x})' },
                        { name: 'math.type', snippet: 'math.type(${1:x})' },
                        { name: 'math.ult', snippet: 'math.ult(${1:m}, ${2:n})' }
                    ];
                    
                    mathLib.forEach(func => {
                        suggestions.push({
                            label: func.name,
                            kind: monaco.languages.CompletionItemKind.Function,
                            documentation: `Math function\n\`${func.snippet}\``,
                            insertText: func.snippet,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                        });
                    });

                    // Common patterns (snippets)
                    const snippets = [
                        {
                            label: 'function',
                            insertText: [
                                'function ${1:name}(${2:params})',
                                '\t${3:-- body}',
                                'end'
                            ].join('\n'),
                            documentation: 'Function declaration'
                        },
                        {
                            label: 'for loop',
                            insertText: [
                                'for ${1:i} = ${2:1}, ${3:10} do',
                                '\t${4:-- body}',
                                'end'
                            ].join('\n'),
                            documentation: 'Numeric for loop'
                        },
                        {
                            label: 'for in loop',
                            insertText: [
                                'for ${1:key}, ${2:value} in pairs(${3:table}) do',
                                '\t${4:-- body}',
                                'end'
                            ].join('\n'),
                            documentation: 'Generic for loop'
                        },
                        {
                            label: 'if statement',
                            insertText: [
                                'if ${1:condition} then',
                                '\t${2:-- body}',
                                'end'
                            ].join('\n'),
                            documentation: 'Conditional statement'
                        },
                        {
                            label: 'if-else',
                            insertText: [
                                'if ${1:condition} then',
                                '\t${2:-- if body}',
                                'else',
                                '\t${3:-- else body}',
                                'end'
                            ].join('\n'),
                            documentation: 'If-else statement'
                        },
                        {
                            label: 'while loop',
                            insertText: [
                                'while ${1:condition} do',
                                '\t${2:-- body}',
                                'end'
                            ].join('\n'),
                            documentation: 'While loop'
                        },
                        {
                            label: 'repeat until',
                            insertText: [
                                'repeat',
                                '\t${1:-- body}',
                                'until ${2:condition}'
                            ].join('\n'),
                            documentation: 'Repeat-until loop'
                        },
                        {
                            label: 'local function',
                            insertText: [
                                'local function ${1:name}(${2:params})',
                                '\t${3:-- body}',
                                'end'
                            ].join('\n'),
                            documentation: 'Local function declaration'
                        },
                        {
                            label: 'table constructor',
                            insertText: '{\n\t${1:-- elements}\n}',
                            documentation: 'Table constructor'
                        },
                        {
                            label: 'metatable',
                            insertText: [
                                'local ${1:mt} = {',
                                '\t__index = function(t, k)',
                                '\t\t${2:-- index metamethod}',
                                '\tend,',
                                '\t__newindex = function(t, k, v)',
                                '\t\t${3:-- newindex metamethod}',
                                '\tend',
                                '}'
                            ].join('\n'),
                            documentation: 'Metatable definition'
                        }
                    ];
                    
                    snippets.forEach(snippet => {
                        suggestions.push({
                            label: snippet.label,
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            documentation: snippet.documentation,
                            insertText: snippet.insertText,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                        });
                    });

                    // Add variables from current document
                    const varMatches = textUntilPosition.matchAll(/\blocal\s+(\w+)/g);
                    for (const match of varMatches) {
                        suggestions.push({
                            label: match[1],
                            kind: monaco.languages.CompletionItemKind.Variable,
                            documentation: 'Local variable',
                            insertText: match[1]
                        });
                    }

                    return { suggestions };
                }
            });

            // Save content on change
            editors['tab1'].onDidChangeModelContent(function() {
                localStorage.setItem('lua_editor_tab1', editors['tab1'].getValue());
            });
            
            // Window resize handler
            window.addEventListener('resize', function() {
                Object.values(editors).forEach(editor => editor.layout());
            });
            
            // Tab functionality
            document.getElementById('add-tab').addEventListener('click', addNewTab);
            
            // Close tab handler
            document.getElementById('tabs-container').addEventListener('click', function(e) {
                if (e.target.classList.contains('tab-close')) {
                    const tabId = e.target.closest('.tab').getAttribute('data-tab-id');
                    closeTab(tabId);
                    e.stopPropagation();
                }
            });
            
            // Switch tab handler
            document.getElementById('tabs-container').addEventListener('click', function(e) {
                const tab = e.target.closest('.tab');
                if (tab && !e.target.classList.contains('tab-close') && !renameInput) {
                    const tabId = tab.getAttribute('data-tab-id');
                    switchTab(tabId);
                }
            });
            
            // Double-click to rename
            document.getElementById('tabs-container').addEventListener('dblclick', function(e) {
                const tab = e.target.closest('.tab');
                if (tab && !e.target.classList.contains('tab-close')) {
                    renameTab(tab);
                }
            });
        });
        
        // Get the next available tab number
        function getNextTabNumber() {
            const tabNumbers = Array.from(document.querySelectorAll('.tab'))
                .map(tab => {
                    const match = tab.querySelector('.tab-name').textContent.match(/script(\d+)\.lua/);
                    return match ? parseInt(match[1]) : 0;
                })
                .filter(num => !isNaN(num));
            
            if (tabNumbers.length === 0) return 1;
            
            const maxExisting = Math.max(...tabNumbers);
            highestTabNumber = Math.max(highestTabNumber, maxExisting) + 1;
            return highestTabNumber;
        }
        
        // Tab functions
        function addNewTab() {
            const tabNumber = getNextTabNumber();
            const tabId = `tab${tabNumber}`;
            const tabName = `script${tabNumber}.lua`;
            
            // Create tab element
            const tab = document.createElement('div');
            tab.className = 'tab fade-in';
            tab.setAttribute('data-tab-id', tabId);
            tab.innerHTML = `
                <i class="fas fa-file-code tab-icon"></i>
                <span class="tab-name">${tabName}</span>
                <span class="tab-close">&times;</span>
            `;
            
            // Add to container
            document.getElementById('tabs-container').appendChild(tab);
            
            // Create editor container
            const editorDiv = document.createElement('div');
            editorDiv.id = `editor-${tabId}`;
            editorDiv.className = 'editor hidden';
            document.getElementById('editor-container').appendChild(editorDiv);
            
            // Initialize editor
            require(['vs/editor/editor.main'], function() {
                editors[tabId] = monaco.editor.create(editorDiv, {
                    value: localStorage.getItem(`lua_editor_${tabId}`) || `-- New Lua script ${tabNumber}\nprint("Hello from script ${tabNumber}!")`,
                    language: 'lua',
                    theme: 'vs-dark',
                    automaticLayout: true,
                    minimap: { enabled: true },
                    fontSize: 14,
                    lineHeight: 22,
                    suggest: {
                        preview: true,
                        showMethods: true,
                        showFunctions: true,
                        showConstructors: true
                    }
                });
                
                // Save content on change
                editors[tabId].onDidChangeModelContent(function() {
                    localStorage.setItem(`lua_editor_${tabId}`, editors[tabId].getValue());
                });
                
                // Switch to new tab
                switchTab(tabId);
            });
        }
        
        function switchTab(tabId) {
            if (activeTabId === tabId) return;
            
            // Update UI
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[data-tab-id="${tabId}"]`).classList.add('active');
            
            // Hide current editor, show new one
            document.querySelectorAll('.editor').forEach(editor => {
                editor.classList.add('hidden');
            });
            document.getElementById(`editor-${tabId}`).classList.remove('hidden');
            
            // Update active tab
            activeTabId = tabId;
            
            // Trigger layout
            if (editors[tabId]) {
                editors[tabId].layout();
            }
        }
        
        function closeTab(tabId) {
            if (Object.keys(editors).length <= 1) return;
            
            // Remove tab from UI
            const tab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
            if (tab) {
                tab.classList.add('fade-out');
                setTimeout(() => tab.remove(), 150);
            }
            
            // Remove editor
            if (editors[tabId]) {
                editors[tabId].dispose();
                delete editors[tabId];
            }
            
            // Remove editor container
            const editorDiv = document.getElementById(`editor-${tabId}`);
            if (editorDiv) editorDiv.remove();
            
            // Switch to another tab if needed
            if (activeTabId === tabId) {
                const remainingTabs = document.querySelectorAll('.tab');
                if (remainingTabs.length > 0) {
                    switchTab(remainingTabs[0].getAttribute('data-tab-id'));
                }
            }
        }
        
        function renameTab(tabElement) {
            if (renameInput) return;
            
            const tabNameElement = tabElement.querySelector('.tab-name');
            const originalName = tabNameElement.textContent;
            
            renameInput = document.createElement('input');
            renameInput.type = 'text';
            renameInput.className = 'tab-edit';
            renameInput.value = originalName;
            
            tabNameElement.textContent = '';
            tabNameElement.appendChild(renameInput);
            renameInput.focus();
            renameInput.select();
            
            function finishRename() {
                const newName = renameInput.value.trim() || originalName;
                tabNameElement.textContent = newName;
                renameInput.remove();
                renameInput = null;
                
                // Save the tab name
                const tabId = tabElement.getAttribute('data-tab-id');
                localStorage.setItem(`lua_editor_name_${tabId}`, newName);
            }
            
            renameInput.addEventListener('blur', finishRename);
            renameInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    finishRename();
                } else if (e.key === 'Escape') {
                    tabNameElement.textContent = originalName;
                    renameInput.remove();
                    renameInput = null;
                }
            });
        }

	

    </script>
</body>
</html>